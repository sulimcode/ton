# Подготовка проекта к деплою на Vercel

## Введение
Этот документ описывает изменения, внесенные в проект для обеспечения совместимости с Vercel. 
Основной акцент был сделан на совместимость с Node.js 18.x, так как Vercel использует именно эту версию по умолчанию.

## Внесенные изменения

### 1. Оптимизация vercel.json
- Удалено недопустимое свойство `nodeVersion`
- Добавлены более подробные настройки для Serverless Functions
- Настроены CORS заголовки для API запросов

### 2. Обеспечение совместимости с Node.js 18.x
- Добавлен полифил для `import.meta.dirname` в API файлах
- Создан вспомогательный модуль `server/polyfill.js`
- Добавлен патч в сборку для автоматического применения полифила

### 3. Улучшение процесса сборки
- Обновлен скрипт `build.js` для копирования необходимых файлов
- Создан `postbuild.js` для дополнительных настроек после сборки
- Добавлены файлы конфигурации версии Node.js в выходную директорию

### 4. Дополнительные файлы конфигурации
- Создан `.vercel/settings.json` для указания версии Node.js
- Добавлен `vercel.cjs` для альтернативной конфигурации
- Добавлен файл `api/_middleware.ts` для обработки CORS в Serverless Functions

## Результат
После этих изменений проект должен успешно деплоиться на Vercel с использованием Node.js 18.x без ошибок.

## Дальнейшие шаги
1. При деплое на Vercel, не забудьте настроить переменные окружения:
   - `DATABASE_URL` для подключения к PostgreSQL базе данных
   - `IP_INFO_API_KEY` (опционально) для получения местоположения по IP
2. Рекомендуется настроить CI/CD для автоматического деплоя при обновлении кода
3. Для повышения производительности рекомендуется настроить кэширование статических ресурсов